(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[74767],{74767:(t,e,n)=>{n.r(e),n.d(e,{default:()=>w});var r=n(75407),i=n(15585),a=n(87742),o=n(56366),s=n(84312),c=n(16727),d=n(42719),l=n(19908),p=n(59996),m=n(61204),u=n(25358),f=n(55514);const g={ByNewCard:0,BySavedCard:1};var y=n(44046);const h=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let b=(()=>{var t;class e{constructor(){this.isE2E=(0,r.WQX)(l.Hs4)}preparePayment(t){return(0,y.O)(this.getRandomDelay()).pipe((0,f.T)((()=>t)))}getPrimaryCard(){return(0,y.O)(this.getRandomDelay()).pipe((0,f.T)((()=>h)),(0,f.T)((t=>({primary:t[0],cards:t}))))}pay(){return(0,y.O)(this.getRandomDelay()).pipe((0,f.T)((()=>{})))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵprov=r.jDH({token:t,factory:t.ɵfac,providedIn:"root"}),e})();var _=n(25083);const C=["cardGroupedInput"];function v(t,e){if(1&t){const t=r.RV6();r.qex(0),r.j41(1,"div",4)(2,"div",9),r.bIt("click",(function(){const e=r.eBV(t).$implicit,n=r.XpG();return r.Njj(n.payBySelectedCard(e))})),r.j41(3,"div",10)(4,"div",11)(5,"div",12),r.EFF(6,"Card number"),r.k0s(),r.j41(7,"div",13),r.nrm(8,"img",14),r.nI1(9,"tuiIcon"),r.j41(10,"div",15),r.EFF(11),r.k0s()()()()()(),r.bVm()}if(2&t){const t=e.$implicit;r.R7$(8),r.Y8G("src",r.bMT(9,3,"MasterCard"===t.cardType?"@tui.maestro":"Visa"===t.cardType?"@tui.visa":"@tui.mir"),r.B4B),r.R7$(3),r.Lme(" ",t.firstSix,"****",t.lastFour," ")}}function M(t,e){1&t&&(r.qex(0),r.nrm(1,"input",16),r.bVm())}function k(t,e){1&t&&(r.j41(0,"p"),r.EFF(1,"Please wait, we are loading fake cards..."),r.k0s())}function x(t,e){if(1&t&&(r.qex(0),r.DNE(1,k,2,0,"p",5),r.j41(2,"tui-loader",17),r.nrm(3,"tui-input-card-group",18,19),r.k0s(),r.bVm()),2&t){const t=e.tuiLet,n=r.XpG();r.R7$(1),r.Y8G("ngIf",t),r.R7$(1),r.Y8G("overlay",!0)("showLoader",t),r.R7$(1),r.AVh("without-date",n.paymentMode===n.PAYMENT_MODE.BySavedCard),r.Y8G("autocomplete",!0)("cardValidator",n.cardValidator)("tuiTextfieldCleaner",n.paymentMode===n.PAYMENT_MODE.ByNewCard)}}function P(t,e){1&t&&(r.qex(0),r.j41(1,"div",4)(2,"label",20),r.nrm(3,"input",21),r.EFF(4," Remember card "),r.k0s()(),r.bVm())}function O(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",22)(1,"button",23),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.payByNewCard())})),r.EFF(2," New card "),r.k0s()()}}let B=(()=>{var t;class e{constructor(){this.payService=(0,r.WQX)(b),this.destroyRef=(0,r.WQX)(r.abz),this.form=new a.gE({card:new a.MJ(null,[a.k0.required,t=>{const{value:e}=t;return e?.cvc&&e.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new a.MJ(!0)}),this.iOS=(0,r.WQX)(l.mg4),this.cards=[],this.paymentMode=g.ByNewCard,this.loading$=new m.t(!1),this.payProcessing$=new m.t(!1),this.PAYMENT_MODE=g,this.context=(0,p.Dm)(),this.amount=this.context.data.amount}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(t){this.form.patchValue({card:{card:this.maskedNumber(t),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(d.WK),this.paymentMode=g.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(d.WK),this.paymentMode=g.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,i.pQ)(this.destroyRef)).subscribe((()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()}),(()=>this.payProcessing$.next(!1))))}cardValidator(t){return(0,d.Cz)(t)&&16===t.length}maskedNumber(t){return`${t.firstSix.toString().slice(0,-2)}***${t.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,u.n)((t=>this.payService.getPrimaryCard().pipe((0,f.T)((e=>[t,e]))))),(0,i.pQ)(this.destroyRef)).subscribe({next:([,t])=>{this.cards=t.cards,t.primary?this.payBySelectedCard(t.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=r.VBU({type:t,selectors:[["pay-modal"]],viewQuery:function(t,e){if(1&t&&r.GBs(C,5),2&t){let t;r.mGM(t=r.lsd())&&(e.cardGroupedInput=t.first)}},standalone:!0,features:[r.aNF],decls:16,vars:16,consts:[[1,"modal-container"],[1,"title"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-block"],[4,"ngIf"],[4,"tuiLet"],["class","form-block is--links",4,"ngIf"],["appearance","primary","size","l","tuiButton","","type","submit",3,"loading","click"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],["alt","card",1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"overlay","showLoader"],["formControlName","card",3,"autocomplete","cardValidator","tuiTextfieldCleaner"],["cardGroupedInput",""],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],[1,"form-block","is--links"],["iconStart","@tui.plus","tuiLink","","type","button",3,"click"]],template:function(t,e){if(1&t&&(r.j41(0,"div",0)(1,"h1",1),r.EFF(2,"Pay by card"),r.k0s(),r.j41(3,"form",2),r.DNE(4,v,12,5,"ng-container",3),r.j41(5,"div",4),r.DNE(6,M,2,0,"ng-container",5),r.DNE(7,x,5,8,"ng-container",6),r.nI1(8,"async"),r.k0s(),r.DNE(9,P,5,0,"ng-container",5),r.DNE(10,O,3,0,"div",7),r.k0s(),r.j41(11,"button",8),r.bIt("click",(function(){return e.pay()})),r.nI1(12,"async"),r.EFF(13),r.nI1(14,"async"),r.nI1(15,"tuiFormatNumber"),r.k0s()()),2&t){let t;r.R7$(3),r.Y8G("formGroup",e.form),r.R7$(1),r.Y8G("ngForOf",e.cards),r.R7$(2),r.Y8G("ngIf",e.iOS),r.R7$(1),r.Y8G("tuiLet",null!==(t=r.bMT(8,8,e.loading$))&&void 0!==t&&t),r.R7$(2),r.Y8G("ngIf",e.paymentMode===e.PAYMENT_MODE.ByNewCard),r.R7$(1),r.Y8G("ngIf",e.paymentMode===e.PAYMENT_MODE.BySavedCard),r.R7$(1),r.Y8G("loading",!!r.bMT(12,10,e.payProcessing$)),r.R7$(2),r.SpI(" Pay ",r.bMT(14,12,r.bMT(15,14,e.amount))," ₽ ")}},dependencies:[c.Jj,c.Sq,c.bT,a.X1,a.qT,a.Zm,a.BC,a.cb,a.j4,a.JD,l.s8y,o.paf,s.FPM,s.GYS,o.VX$,o.KYT,d.Qf,l.cOJ,o.Jc3,o.apU,_.z,o.TB_],styles:['[_nghost-%COMP%]     tui-input-card-group{inline-size:100%!important}[_nghost-%COMP%]     tui-input-card-group.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-group.without-date tui-icon[icon="@tui.x"]{display:none}[_nghost-%COMP%]     tui-input-card-group .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{inline-size:30rem}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{inline-size:100%}}.title[_ngcontent-%COMP%]{margin:0 0 16px;font-weight:500;font-size:1.125rem;line-height:1.625rem;letter-spacing:.01125rem}.form-block[_ngcontent-%COMP%]{position:relative;margin-bottom:16px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{display:flex;block-size:3.5rem;background:#fafbfb;border-radius:16px;border:2px solid #eaeaea;padding:0 16px;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.015rem;font-size:.75rem;line-height:1.125rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{inline-size:2.25rem;block-size:1.375rem;background-position:center;background-repeat:no-repeat;margin-right:.5rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:1.375rem;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:.875rem;line-height:1.25rem}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-left:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;inline-size:100%;caret-color:transparent;cursor:none;color:transparent}'],changeDetection:0}),e})();const w=(()=>{var t;class e{constructor(){this.destroyRef=(0,r.WQX)(r.abz),this.payModal=(0,o.$V3)(B,{size:"auto",closeable:!0}),this.amountControl=new a.MJ(100,{nonNullable:!0})}payByCard(){this.payModal({amount:this.amountControl.value}).pipe((0,i.pQ)(this.destroyRef)).subscribe()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=r.VBU({type:t,selectors:[["ng-component"]],standalone:!0,exportAs:"Example9",features:[r.aNF],decls:13,vars:11,consts:[[1,"container"],["maxlength","5","placeholder","0 ... 999 ₽","postfix"," ₽","tuiInputNumber","",3,"formControl","min"],["tuiHintDirection","top","tuiTooltip","The amount must be less than 1000 ₽"],["tuiButton","","type","button",1,"pay-button",3,"click"],[1,"icon-group"],["alt","visa",3,"src"],["alt","maestro",3,"src"],["alt","mir",3,"src"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"tui-textfield"),r.nrm(2,"input",1)(3,"tui-icon",2),r.k0s(),r.j41(4,"button",3),r.bIt("click",(function(){return e.payByCard()})),r.j41(5,"div",4),r.nrm(6,"img",5),r.nI1(7,"tuiIcon"),r.nrm(8,"img",6),r.nI1(9,"tuiIcon"),r.nrm(10,"img",7),r.nI1(11,"tuiIcon"),r.k0s(),r.EFF(12," Pay "),r.k0s()()),2&t&&(r.R7$(2),r.Y8G("formControl",e.amountControl)("min",0),r.R7$(4),r.Y8G("src",r.bMT(7,5,"@tui.visa"),r.B4B),r.R7$(2),r.Y8G("src",r.bMT(9,7,"@tui.maestro"),r.B4B),r.R7$(2),r.Y8G("src",r.bMT(11,9,"@tui.mir"),r.B4B))},dependencies:[a.X1,a.me,a.BC,a.tU,a.l_,o.paf,o.qo5,o.KYT,s.xhp,o.Bwv,s.w1A],styles:[".container[_ngcontent-%COMP%]{inline-size:100%;max-inline-size:30rem;margin:0 auto;padding-top:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-top:1rem;inline-size:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-right:.5rem;border-radius:.3125rem}img[_ngcontent-%COMP%]{inline-size:1.5rem;block-size:1.5rem}"],changeDetection:0}),e})()}}]);