(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[44351],{44351:(t,e,i)=>{i.r(e),i.d(e,{TuiDialogExampleComponent9:()=>Y});var r=i(20755),n=i(72133),a=i(25373),o=i(64064),c=i(6254),s=i(81749),d=i(59611),p=i(56424),u=i(84787),l=i(92425);const m={ByNewCard:0,BySavedCard:1};var g=i(1925);const f=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let h=(()=>{var t;class e{constructor(){this.isE2E=(0,r.f3M)(a.TUI_IS_E2E)}preparePayment(t){return(0,g.H)(this.getRandomDelay()).pipe((0,l.U)((()=>t)))}getPrimaryCard(){return(0,g.H)(this.getRandomDelay()).pipe((0,l.U)((()=>f)),(0,l.U)((t=>({primary:t[0],cards:t}))))}pay(){return(0,g.H)(this.getRandomDelay()).pipe((0,l.U)((()=>{})))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵprov=r.Yz7({token:t,factory:t.ɵfac,providedIn:"root"}),e})();var y=i(76733),_=i(27146),x=i(62998),C=i(85241),v=i(59311),b=i(47880),M=i(59590),k=i(40306),P=i(4732),w=i(36379),T=i(37419),O=i(22821);const Z=["cardGroupedInput"];function N(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",4)(2,"div",9),r.NdJ("click",(function(){const e=r.CHM(t).$implicit,i=r.oxw();return r.KtG(i.payBySelectedCard(e))})),r.TgZ(3,"div",10)(4,"div",11)(5,"div",12),r._uU(6,"Card number"),r.qZA(),r.TgZ(7,"div",13),r._UZ(8,"tui-svg",14),r.TgZ(9,"div",15),r._uU(10),r.qZA()()()()()(),r.BQk()}if(2&t){const t=e.$implicit;r.xp6(8),r.Q6J("src","MasterCard"===t.cardType?"tuiIconMaestro":"Visa"===t.cardType?"tuiIconVisa":"tuiIconMir"),r.xp6(2),r.AsE(" ",t.firstSix,"****",t.lastFour," ")}}function I(t,e){1&t&&(r.ynx(0),r._UZ(1,"input",16),r.BQk())}function S(t,e){1&t&&(r.TgZ(0,"p"),r._uU(1,"Please wait, we are loading fake cards..."),r.qZA())}function A(t,e){if(1&t&&(r.ynx(0),r.YNc(1,S,2,0,"p",5),r.TgZ(2,"tui-loader",17),r._UZ(3,"tui-input-card-grouped",18,19),r.qZA(),r.BQk()),2&t){const t=e.tuiLet,i=r.oxw();r.xp6(1),r.Q6J("ngIf",t),r.xp6(1),r.Q6J("overlay",!0)("showLoader",t),r.xp6(1),r.ekj("without-date",i.paymentMode===i.PAYMENT_MODE.BySavedCard),r.Q6J("autocompleteEnabled",!0)("cardValidator",i.cardValidator)("tuiTextfieldCleaner",i.paymentMode===i.PAYMENT_MODE.ByNewCard)}}function B(t,e){1&t&&(r.ynx(0),r.TgZ(1,"div",4)(2,"label",20),r._UZ(3,"input",21),r._uU(4," Remember card "),r.qZA()(),r.BQk())}function E(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div",22)(1,"a",23),r.NdJ("click",(function(){r.CHM(t);const e=r.oxw();return r.KtG(e.payByNewCard())})),r._uU(2," New card "),r.qZA()()}}let U=(()=>{var t;class e{constructor(){this.payService=(0,r.f3M)(h),this.destroy$=(0,r.f3M)(a.TuiDestroyService,{self:!0}),this.form=new n.cw({card:new n.NI(null,[n.kI.required,t=>{const{value:e}=t;return e?.cvc&&e.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new n.NI(!0)}),this.context=(0,r.f3M)(c.yf),this.iOS=(0,r.f3M)(a.TUI_IS_IOS),this.cards=[],this.paymentMode=m.ByNewCard,this.loading$=new p.X(!1),this.payProcessing$=new p.X(!1),this.amount=this.context?.data?.amount??0,this.PAYMENT_MODE=m}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(t){this.form.patchValue({card:{card:this.maskedNumber(t),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(d.tuiCardNumberValidator),this.paymentMode=m.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(d.tuiCardNumberValidator),this.paymentMode=m.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,s.R)(this.destroy$)).subscribe((()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()}),(()=>this.payProcessing$.next(!1))))}cardValidator(t){return(0,d.tuiDefaultCardValidator)(t)&&16===t.length}maskedNumber(t){return`${t.firstSix.toString().slice(0,-2)}***${t.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,u.w)((t=>this.payService.getPrimaryCard().pipe((0,l.U)((e=>[t,e]))))),(0,s.R)(this.destroy$)).subscribe({next:([,t])=>{this.cards=t.cards,t.primary?this.payBySelectedCard(t.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=r.Xpm({type:t,selectors:[["pay-modal"]],viewQuery:function(t,e){if(1&t&&r.Gf(Z,5),2&t){let t;r.iGM(t=r.CRH())&&(e.cardGroupedInput=t.first)}},features:[r._Bn([a.TuiDestroyService])],decls:16,vars:16,consts:[[1,"modal-container"],[1,"title"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-block"],[4,"ngIf"],[4,"tuiLet"],["class","form-block is--links",4,"ngIf"],["appearance","primary","size","l","tuiButton","","type","submit",3,"showLoader","click"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],[1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"overlay","showLoader"],["formControlName","card",3,"autocompleteEnabled","cardValidator","tuiTextfieldCleaner"],["cardGroupedInput",""],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],[1,"form-block","is--links"],["icon","tuiIconPlus","iconAlign","left","tuiLink","",3,"click"]],template:function(t,e){if(1&t&&(r.TgZ(0,"div",0)(1,"h1",1),r._uU(2,"Pay by card"),r.qZA(),r.TgZ(3,"form",2),r.YNc(4,N,11,3,"ng-container",3),r.TgZ(5,"div",4),r.YNc(6,I,2,0,"ng-container",5),r.YNc(7,A,5,8,"ng-container",6),r.ALo(8,"async"),r.qZA(),r.YNc(9,B,5,0,"ng-container",5),r.YNc(10,E,3,0,"div",7),r.qZA(),r.TgZ(11,"button",8),r.NdJ("click",(function(){return e.pay()})),r.ALo(12,"async"),r._uU(13),r.ALo(14,"async"),r.ALo(15,"tuiFormatNumber"),r.qZA()()),2&t){let t;r.xp6(3),r.Q6J("formGroup",e.form),r.xp6(1),r.Q6J("ngForOf",e.cards),r.xp6(2),r.Q6J("ngIf",e.iOS),r.xp6(1),r.Q6J("tuiLet",null!==(t=r.lcZ(8,8,e.loading$))&&void 0!==t&&t),r.xp6(2),r.Q6J("ngIf",e.paymentMode===e.PAYMENT_MODE.ByNewCard),r.xp6(1),r.Q6J("ngIf",e.paymentMode===e.PAYMENT_MODE.BySavedCard),r.xp6(1),r.Q6J("showLoader",!!r.lcZ(12,10,e.payProcessing$)),r.xp6(2),r.hij(" Pay ",r.lcZ(14,12,r.lcZ(15,14,e.amount))," ₽ ")}},dependencies:[y.sg,y.O5,n._Y,n.Wl,n.JJ,n.JL,_.V,x.P,C.L,v.k,b.v,M.k,n.sg,n.u,k.c,P.b,w.X,T.f,y.Ov,O.m],styles:["[_nghost-%COMP%]     tui-input-card-grouped{width:100%!important}[_nghost-%COMP%]     tui-input-card-grouped.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-grouped.without-date tui-svg[src=tuiIconClose]{display:none}[_nghost-%COMP%]     tui-input-card-grouped .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{width:480px}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{width:100%}}.title[_ngcontent-%COMP%]{margin:0 0 16px;font-weight:500;font-size:18px;line-height:26px;letter-spacing:.18px}.form-block[_ngcontent-%COMP%]{position:relative;margin-bottom:16px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{height:56px;background:#fafbfb;border-radius:16px;border:2px solid #eaeaea;padding:0 16px;display:flex;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.24px;font-size:12px;line-height:18px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{width:36px;height:22px;background-position:center;background-repeat:no-repeat;margin-right:8px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:22px;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:14px;line-height:20px}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-left:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;width:100%;caret-color:transparent;cursor:none;color:transparent}"],changeDetection:0}),e})();var J=i(18026),D=i(90189),$=i(90096),L=i(52891),Q=i(91734),V=i(59915),q=i(77441);let Y=(()=>{var t;class e{constructor(){this.dialogs=(0,r.f3M)(o.TuiDialogService),this.destroy$=(0,r.f3M)(a.TuiDestroyService,{self:!0}),this.amountControl=new n.NI(100)}payByCard(){this.dialogs.open(new c.Al(U),{size:"auto",closeable:!0,data:{amount:this.amountControl.value}}).pipe((0,s.R)(this.destroy$)).subscribe()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=r.Xpm({type:t,selectors:[["tui-dialog-example-9"]],features:[r._Bn([a.TuiDestroyService])],decls:10,vars:3,consts:[[1,"container"],["tuiHintContent","The amount must be less than 1000 ₽","tuiHintDirection","top","tuiTextfieldPostfix","₽","tuiTextfieldSize","l",3,"formControl","tuiTextfieldCleaner","tuiTextfieldLabelOutside"],["inputmode","numeric","maxlength","5","tuiTextfield",""],["tuiButton","",1,"pay-button",3,"click"],[1,"icon-group"],["src","tuiIconVisa"],["src","tuiIconMaestro"],["src","tuiIconMir"]],template:function(t,e){1&t&&(r.TgZ(0,"div",0)(1,"tui-input-number",1),r._uU(2," 0 ... 999 ₽ "),r._UZ(3,"input",2),r.qZA(),r.TgZ(4,"button",3),r.NdJ("click",(function(){return e.payByCard()})),r.TgZ(5,"div",4),r._UZ(6,"tui-svg",5)(7,"tui-svg",6)(8,"tui-svg",7),r.qZA(),r._uU(9," Pay "),r.qZA()()),2&t&&(r.xp6(1),r.Q6J("formControl",e.amountControl)("tuiTextfieldCleaner",!0)("tuiTextfieldLabelOutside",!0))},dependencies:[n.JJ,n.oH,b.v,J.M,D.bZ,x.P,$.q,L.g,P.b,Q.x,V.s,q.T],styles:[".container[_ngcontent-%COMP%]{width:100%;max-width:30rem;margin:0 auto;padding-top:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-top:1rem;width:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-right:.5rem;border-radius:.3125rem}"],changeDetection:0}),e})()}}]);