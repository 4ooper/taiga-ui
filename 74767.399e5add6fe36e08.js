(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[74767],{74767:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var i=n(75407),r=n(15585),a=n(87742),o=n(7287),s=n(26197),c=n(59996),d=n(16727),l=n(70295),u=n(49493),p=n(89684),m=n(61204),f=n(25358),g=n(55514);const y={ByNewCard:0,BySavedCard:1};var h=n(44046);const _=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let b=(()=>{var e;class t{constructor(){this.isE2E=(0,i.WQX)(u.Hs4)}preparePayment(e){return(0,h.O)(this.getRandomDelay()).pipe((0,g.T)((()=>e)))}getPrimaryCard(){return(0,h.O)(this.getRandomDelay()).pipe((0,g.T)((()=>_)),(0,g.T)((e=>({primary:e[0],cards:e}))))}pay(){return(0,h.O)(this.getRandomDelay()).pipe((0,g.T)((()=>{})))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵprov=i.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),t})();var C=n(25083);const v=["cardGroupedInput"];function k(e,t){if(1&e){const e=i.RV6();i.qex(0),i.j41(1,"div",4)(2,"div",9),i.bIt("click",(function(){const t=i.eBV(e).$implicit,n=i.XpG();return i.Njj(n.payBySelectedCard(t))})),i.j41(3,"div",10)(4,"div",11)(5,"div",12),i.EFF(6,"Card number"),i.k0s(),i.j41(7,"div",13),i.nrm(8,"img",14),i.nI1(9,"tuiIcon"),i.j41(10,"div",15),i.EFF(11),i.k0s()()()()()(),i.bVm()}if(2&e){const e=t.$implicit;i.R7$(8),i.Y8G("src",i.bMT(9,3,"MasterCard"===e.cardType?"@tui.maestro":"Visa"===e.cardType?"@tui.visa":"@tui.mir"),i.B4B),i.R7$(3),i.Lme(" ",e.firstSix,"****",e.lastFour," ")}}function M(e,t){1&e&&(i.qex(0),i.nrm(1,"input",16),i.bVm())}function x(e,t){1&e&&(i.j41(0,"p"),i.EFF(1,"Please wait, we are loading fake cards..."),i.k0s())}function P(e,t){if(1&e&&(i.qex(0),i.DNE(1,x,2,0,"p",5),i.j41(2,"tui-loader",17),i.nrm(3,"tui-input-card-group",18,19),i.k0s(),i.bVm()),2&e){const e=t.tuiLet,n=i.XpG();i.R7$(1),i.Y8G("ngIf",e),i.R7$(1),i.Y8G("overlay",!0)("showLoader",e),i.R7$(1),i.AVh("without-date",n.paymentMode===n.PAYMENT_MODE.BySavedCard),i.Y8G("autocomplete",!0)("cardValidator",n.cardValidator)("tuiTextfieldCleaner",n.paymentMode===n.PAYMENT_MODE.ByNewCard)}}function O(e,t){1&e&&(i.qex(0),i.j41(1,"div",4)(2,"label",20),i.nrm(3,"input",21),i.EFF(4," Remember card "),i.k0s()(),i.bVm())}function T(e,t){if(1&e){const e=i.RV6();i.j41(0,"div",22)(1,"button",23),i.bIt("click",(function(){i.eBV(e);const t=i.XpG();return i.Njj(t.payByNewCard())})),i.EFF(2," New card "),i.k0s()()}}let B=(()=>{var e;class t{constructor(){this.payService=(0,i.WQX)(b),this.destroyRef=(0,i.WQX)(i.abz),this.form=new a.gE({card:new a.MJ(null,[a.k0.required,e=>{const{value:t}=e;return t?.cvc&&t.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new a.MJ(!0)}),this.context=(0,i.WQX)(c.su),this.iOS=(0,i.WQX)(u.mg4),this.cards=[],this.paymentMode=y.ByNewCard,this.loading$=new m.t(!1),this.payProcessing$=new m.t(!1),this.amount=this.context?.data?.amount??0,this.PAYMENT_MODE=y}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(e){this.form.patchValue({card:{card:this.maskedNumber(e),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(l.WK),this.paymentMode=y.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(l.WK),this.paymentMode=y.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,r.pQ)(this.destroyRef)).subscribe((()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()}),(()=>this.payProcessing$.next(!1))))}cardValidator(e){return(0,l.Cz)(e)&&16===e.length}maskedNumber(e){return`${e.firstSix.toString().slice(0,-2)}***${e.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,f.n)((e=>this.payService.getPrimaryCard().pipe((0,g.T)((t=>[e,t]))))),(0,r.pQ)(this.destroyRef)).subscribe({next:([,e])=>{this.cards=e.cards,e.primary?this.payBySelectedCard(e.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵcmp=i.VBU({type:e,selectors:[["pay-modal"]],viewQuery:function(e,t){if(1&e&&i.GBs(v,5),2&e){let e;i.mGM(e=i.lsd())&&(t.cardGroupedInput=e.first)}},standalone:!0,features:[i.aNF],decls:16,vars:16,consts:[[1,"modal-container"],[1,"title"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-block"],[4,"ngIf"],[4,"tuiLet"],["class","form-block is--links",4,"ngIf"],["appearance","primary","size","l","tuiButton","","type","submit",3,"loading","click"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],[1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"overlay","showLoader"],["formControlName","card",3,"autocomplete","cardValidator","tuiTextfieldCleaner"],["cardGroupedInput",""],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],[1,"form-block","is--links"],["iconStart","@tui.plus","tuiLink","",3,"click"]],template:function(e,t){if(1&e&&(i.j41(0,"div",0)(1,"h1",1),i.EFF(2,"Pay by card"),i.k0s(),i.j41(3,"form",2),i.DNE(4,k,12,5,"ng-container",3),i.j41(5,"div",4),i.DNE(6,M,2,0,"ng-container",5),i.DNE(7,P,5,8,"ng-container",6),i.nI1(8,"async"),i.k0s(),i.DNE(9,O,5,0,"ng-container",5),i.DNE(10,T,3,0,"div",7),i.k0s(),i.j41(11,"button",8),i.bIt("click",(function(){return t.pay()})),i.nI1(12,"async"),i.EFF(13),i.nI1(14,"async"),i.nI1(15,"tuiFormatNumber"),i.k0s()()),2&e){let e;i.R7$(3),i.Y8G("formGroup",t.form),i.R7$(1),i.Y8G("ngForOf",t.cards),i.R7$(2),i.Y8G("ngIf",t.iOS),i.R7$(1),i.Y8G("tuiLet",null!==(e=i.bMT(8,8,t.loading$))&&void 0!==e&&e),i.R7$(2),i.Y8G("ngIf",t.paymentMode===t.PAYMENT_MODE.ByNewCard),i.R7$(1),i.Y8G("ngIf",t.paymentMode===t.PAYMENT_MODE.BySavedCard),i.R7$(1),i.Y8G("loading",!!i.bMT(12,10,t.payProcessing$)),i.R7$(2),i.SpI(" Pay ",i.bMT(14,12,i.bMT(15,14,t.amount))," ₽ ")}},dependencies:[a.X1,a.qT,a.Zm,a.BC,a.cb,a.j4,a.JD,d.Sq,d.bT,o.Jc3,o.paf,p.FPM,d.Jj,o.VX$,u.cOJ,u.s8y,o.apU,l.Qf,C.z,o.TB_,p.GYS,o.KYT],styles:['[_nghost-%COMP%]     tui-input-card-group{inline-size:100%!important}[_nghost-%COMP%]     tui-input-card-group.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-group.without-date tui-icon[icon="@tui.x"]{display:none}[_nghost-%COMP%]     tui-input-card-group .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{inline-size:30rem}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{inline-size:100%}}.title[_ngcontent-%COMP%]{margin:0 0 16px;font-weight:500;font-size:1.125rem;line-height:1.625rem;letter-spacing:.01125rem}.form-block[_ngcontent-%COMP%]{position:relative;margin-bottom:16px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{display:flex;block-size:3.5rem;background:#fafbfb;border-radius:16px;border:2px solid #eaeaea;padding:0 16px;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.015rem;font-size:.75rem;line-height:1.125rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{inline-size:2.25rem;block-size:1.375rem;background-position:center;background-repeat:no-repeat;margin-right:.5rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:1.375rem;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:.875rem;line-height:1.25rem}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-left:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;inline-size:100%;caret-color:transparent;cursor:none;color:transparent}'],changeDetection:0}),t})();var w=n(3358),I=n(69468),E=n(35630),$=n(96692),F=n(36626),N=n(25751),G=n(3083);const R=(()=>{var e;class t{constructor(){this.dialogs=(0,i.WQX)(o.wXC),this.destroyRef=(0,i.WQX)(i.abz),this.amountControl=new a.MJ(100)}payByCard(){this.dialogs.open(new c.lS(B),{size:"auto",closeable:!0,data:{amount:this.amountControl.value}}).pipe((0,r.pQ)(this.destroyRef)).subscribe()}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵcmp=i.VBU({type:e,selectors:[["ng-component"]],standalone:!0,exportAs:"Example9",features:[i.aNF],decls:13,vars:12,consts:[[1,"container"],["tuiHintContent","The amount must be less than 1000 ₽","tuiHintDirection","top","tuiTextfieldPostfix","₽","tuiTextfieldSize","l",3,"formControl","tuiTextfieldCleaner","tuiTextfieldLabelOutside"],["inputmode","numeric","maxlength","5","tuiTextfieldLegacy",""],["tuiButton","",1,"pay-button",3,"click"],[1,"icon-group"],[3,"src"]],template:function(e,t){1&e&&(i.j41(0,"div",0)(1,"tui-input-number",1),i.EFF(2," 0 ... 999 ₽ "),i.nrm(3,"input",2),i.k0s(),i.j41(4,"button",3),i.bIt("click",(function(){return t.payByCard()})),i.j41(5,"div",4),i.nrm(6,"img",5),i.nI1(7,"tuiIcon"),i.nrm(8,"img",5),i.nI1(9,"tuiIcon"),i.nrm(10,"img",5),i.nI1(11,"tuiIcon"),i.k0s(),i.EFF(12," Pay "),i.k0s()()),2&e&&(i.R7$(1),i.Y8G("formControl",t.amountControl)("tuiTextfieldCleaner",!0)("tuiTextfieldLabelOutside",!0),i.R7$(5),i.Y8G("src",i.bMT(7,6,"@tui.visa"),i.B4B),i.R7$(2),i.Y8G("src",i.bMT(9,8,"@tui.maestro"),i.B4B),i.R7$(2),i.Y8G("src",i.bMT(11,10,"@tui.mir"),i.B4B))},dependencies:[s.O9v,w.Z,I.x,E.B,a.X1,a.BC,a.l_,o.TB_,s.CNI,$.n,F.k,N.G,G.O,o.bkE,o.paf,o.KYT],styles:[".container[_ngcontent-%COMP%]{inline-size:100%;max-inline-size:30rem;margin:0 auto;padding-top:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-top:1rem;inline-size:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-right:.5rem;border-radius:.3125rem}img[_ngcontent-%COMP%]{inline-size:1.5rem;block-size:1.5rem}"],changeDetection:0}),t})()}}]);